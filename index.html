<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MTI Platform</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #000000;
            --card: #1C1C1E;
            --secondary-card: #2C2C2E;
            --accent: #007AFF;
            --text: #FFFFFF;
            --text-gray: #8E8E93;
            --border: rgba(255, 255, 255, 0.1);
            --error: #FF453A;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            padding: calc(env(safe-area-inset-top) + 20px) 16px 100px;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Header */
        header { margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .logo { height: 32px; }

        /* Grid */
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
        
        .card {
            background: var(--card);
            border-radius: 24px;
            padding: 20px;
            border: 0.5px solid var(--border);
            position: relative;
            overflow: hidden;
            transition: transform 0.1s;
        }
        .card:active { transform: scale(0.98); background: var(--secondary-card); }
        
        .card-label { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
        .card-sub { font-size: 12px; color: var(--text-gray); line-height: 1.2; }

        /* Setup Screen (Slide-up) */
        #setup-screen {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 100;
            padding: calc(env(safe-area-inset-top) + 10px) 16px 40px;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }
        #setup-screen.active { transform: translateY(0); }

        .section-title {
            font-size: 13px;
            color: var(--text-gray);
            text-transform: uppercase;
            margin: 24px 4px 8px;
            letter-spacing: 0.5px;
        }

        /* Form Elements */
        .input-group {
            background: var(--card);
            border-radius: 14px;
            border: 0.5px solid var(--border);
            overflow: hidden;
        }

        .input-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 0.5px solid var(--border);
        }
        .input-item:last-child { border-bottom: none; }

        .input-item label { width: 100px; font-size: 15px; color: var(--text-gray); }
        .input-item input, .input-item textarea {
            flex: 1;
            background: none;
            border: none;
            color: var(--text);
            font-size: 16px;
            outline: none;
            text-align: right;
        }

        /* Payment Selector */
        .pay-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .pay-option {
            flex: 1;
            background: var(--card);
            padding: 16px;
            border-radius: 16px;
            border: 2px solid transparent;
            text-align: center;
            transition: 0.2s;
        }
        .pay-option.active { border-color: var(--accent); background: rgba(0, 122, 255, 0.1); }
        .pay-option i { display: block; font-style: normal; font-size: 20px; margin-bottom: 4px; }
        .pay-option span { font-size: 13px; font-weight: 600; }

        /* Status Badge */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .badge-new { background: var(--accent); color: white; }

        .price-tag {
            font-size: 24px;
            font-weight: 800;
            text-align: center;
            margin: 20px 0;
            color: var(--accent);
        }

        .hint {
            font-size: 12px;
            color: var(--text-gray);
            padding: 8px 16px;
            line-height: 1.4;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <img src="https://via.placeholder.com/100x30/000?text=MTI+CORE" alt="MTI" class="logo">
        <div style="font-size: 12px; color: var(--text-gray);">v2.4 Stable</div>
    </header>

    <div class="main-grid">
        <div class="card" onclick="openSetup('Beauty')">
            <div class="badge badge-new">Popular</div>
            <div class="card-label">Beauty</div>
            <div class="card-sub">–ó–∞–ø–∏—Å—å, CRM –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —Å—Ç—É–¥–∏–π</div>
        </div>
        <div class="card" onclick="openSetup('Crypto')">
            <div class="card-label">Crypto</div>
            <div class="card-sub">–ü—Ä–∏–µ–º –ø–ª–∞—Ç–µ–∂–µ–π –∏ VIP-–∫–∞–Ω–∞–ª—ã</div>
        </div>
    </div>

    <div class="card" style="margin-bottom: 12px;" onclick="openSetup('AI')">
        <div class="card-label">AI Agent</div>
        <div class="card-sub">–£–º–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫ 24/7</div>
    </div>

    <div class="section-title">–í–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã</div>
    <div id="empty-state" class="hint" style="text-align: center; padding: 40px 0;">
        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫.<br>–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥—É–ª—å –≤—ã—à–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.
    </div>
</div>

<!-- SETUP SCREEN -->
<div id="setup-screen">
    <h1 id="setup-title" style="font-size: 32px; margin: 0 0 8px 0;">Module</h1>
    <p id="setup-desc" style="color: var(--text-gray); margin-bottom: 24px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å–∞</p>

    <div class="section-title">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</div>
    <div class="pay-selector">
        <div class="pay-option active" id="pay-card" onclick="setPayMethod('card')">
            <i>üí≥</i>
            <span>–ö–∞—Ä—Ç–∞ –†–§</span>
        </div>
        <div class="pay-option" id="pay-crypto" onclick="setPayMethod('crypto')">
            <i>üíé</i>
            <span>–ö—Ä–∏–ø—Ç–∞</span>
        </div>
    </div>

    <div class="section-title">–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>
    <div class="input-group">
        <div class="input-item">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input type="text" id="inp-project-name" placeholder="–ù–∞–ø—Ä: My Studio">
        </div>
        <div class="input-item">
            <label>Bot Token</label>
            <input type="text" id="inp-bot-token" placeholder="567890:ABC...">
        </div>
    </div>
    <div class="hint">–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —É @BotFather</div>

    <div id="dynamic-fields">
        <!-- –ü–æ–ª—è –º–µ–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
    </div>

    <div class="section-title">–°—Ç–æ–∏–º–æ—Å—Ç—å</div>
    <div class="price-tag" id="display-price">2500 ‚ÇΩ / –º–µ—Å</div>

    <div style="height: 40px;"></div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.enableClosingConfirmation();

    let currentModule = '';
    let currentPayMethod = 'card';

    const moduleConfig = {
        'Beauty': {
            price: 2500,
            priceCrypto: 25,
            fields: [
                { id: 'b-address', label: '–ê–¥—Ä–µ—Å', placeholder: '—É–ª. –ü—É—à–∫–∏–Ω–∞, 10' },
                { id: 'b-manager', label: '–ú–µ–Ω–µ–¥–∂–µ—Ä', placeholder: '@username' }
            ]
        },
        'Crypto': {
            price: 5000,
            priceCrypto: 50,
            fields: [
                { id: 'c-wallet', label: '–ö–æ—à–µ–ª–µ–∫', placeholder: 'TON –∏–ª–∏ USDT –∞–¥—Ä–µ—Å' },
                { id: 'c-channel', label: 'ID –ö–∞–Ω–∞–ª–∞', placeholder: '-100...' }
            ]
        },
        'AI': {
            price: 8000,
            priceCrypto: 80,
            fields: [
                { id: 'a-prompt', label: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è', placeholder: '–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –≤...' }
            ]
        }
    };

    function openSetup(modId) {
        currentModule = modId;
        const config = moduleConfig[modId];
        
        document.getElementById('setup-title').innerText = modId;
        document.getElementById('setup-screen').classList.add('active');
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–æ–ø. –ø–æ–ª—è
        const container = document.getElementById('dynamic-fields');
        container.innerHTML = `<div class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥—É–ª—è</div><div class="input-group"></div>`;
        const group = container.querySelector('.input-group');
        
        config.fields.forEach(field => {
            group.innerHTML += `
                <div class="input-item">
                    <label>${field.label}</label>
                    <input type="text" id="${field.id}" placeholder="${field.placeholder}">
                </div>
            `;
        });

        updatePrice();
        
        tg.BackButton.show();
        tg.MainButton.text = "–û–ü–õ–ê–¢–ò–¢–¨ –ò –ó–ê–ü–£–°–¢–ò–¢–¨";
        tg.MainButton.show();
        tg.HapticFeedback.impactOccurred('medium');
    }

    function setPayMethod(method) {
        currentPayMethod = method;
        document.getElementById('pay-card').classList.toggle('active', method === 'card');
        document.getElementById('pay-crypto').classList.toggle('active', method === 'crypto');
        updatePrice();
        tg.HapticFeedback.selectionChanged();
    }

    function updatePrice() {
        const config = moduleConfig[currentModule];
        const priceText = currentPayMethod === 'card' 
            ? `${config.price} ‚ÇΩ / –º–µ—Å` 
            : `${config.priceCrypto} USDT / –º–µ—Å`;
        document.getElementById('display-price').innerText = priceText;
    }

    tg.BackButton.onClick(() => {
        document.getElementById('setup-screen').classList.remove('active');
        tg.BackButton.hide();
        tg.MainButton.hide();
    });

    tg.MainButton.onClick(async () => {
        const projectName = document.getElementById('inp-project-name').value;
        const botToken = document.getElementById('inp-bot-token').value;

        if (!projectName || !botToken) {
            tg.showAlert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ Bot Token");
            return;
        }

        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
        const formData = {
            module: currentModule,
            projectName,
            botToken,
            payMethod: currentPayMethod,
            userId: tg.initDataUnsafe?.user?.id || 0,
            details: {}
        };

        moduleConfig[currentModule].fields.forEach(f => {
            formData.details[f.id] = document.getElementById(f.id).value;
        });

        tg.MainButton.showProgress();

        try {
            // –û–¢–ü–†–ê–í–ö–ê –ù–ê –ë–≠–ö–ï–ù–î
            const response = await fetch('https://your-backend.com/api/create-payment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });

            const result = await response.json();

            if (result.payUrl) {
                tg.openLink(result.payUrl);
            } else {
                tg.showAlert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞");
            }
        } catch (e) {
            tg.showAlert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
        } finally {
            tg.MainButton.hideProgress();
        }
    });

</script>
</body>
</html>
