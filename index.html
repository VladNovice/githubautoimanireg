<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MTI Admin Panel</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #000000;
            --card: #1C1C1E;
            --secondary-card: #2C2C2E;
            --accent: #007AFF;
            --text: #FFFFFF;
            --text-gray: #8E8E93;
            --border: rgba(255, 255, 255, 0.1);
            --input-bg: #2C2C2E;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            padding: calc(env(safe-area-inset-top) + 20px) 16px 100px;
            max-width: 440px;
            margin: 0 auto;
        }

        /* Header */
        header { margin-bottom: 32px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .logo { height: 32px; }

        /* Lang Switcher */
        .lang-selector {
            position: relative; background: rgba(255, 255, 255, 0.08);
            border-radius: 10px; padding: 2px; display: flex; width: 84px; height: 32px;
        }
        .lang-option {
            flex: 1; display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: 600; color: var(--text-gray); z-index: 2; cursor: pointer;
        }
        .lang-option.active { color: #fff; }
        .lang-glider {
            position: absolute; top: 2px; left: 2px; width: 40px; height: 28px;
            background: rgba(255, 255, 255, 0.15); border-radius: 8px; z-index: 1;
            transition: transform 0.3s ease;
        }
        body.lang-en .lang-glider { transform: translateX(40px); }

        /* Cards */
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
        .card {
            background: var(--card); border-radius: 24px; padding: 20px;
            border: 0.5px solid var(--border); transition: 0.2s; position: relative; overflow: hidden;
        }
        .card:active { background: var(--secondary-card); }
        .card-label { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
        .card-sub { font-size: 12px; color: var(--text-gray); line-height: 1.2; }

        /* Setup Screen (Full Screen Modal) */
        #setup-screen {
            position: fixed; inset: 0; background: var(--bg); z-index: 1000;
            padding: calc(env(safe-area-inset-top) + 10px) 16px;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.15, 0.4, 0.05, 1);
            overflow-y: auto;
        }
        #setup-screen.active { transform: translateY(0); }

        .section-title {
            font-size: 13px; color: var(--text-gray); text-transform: uppercase;
            margin: 24px 4px 8px; letter-spacing: 0.5px;
        }

        .input-group {
            background: var(--card); border-radius: 14px; overflow: hidden;
            border: 0.5px solid var(--border);
        }

        .input-row {
            display: flex; align-items: center; padding: 12px 16px;
            border-bottom: 0.5px solid var(--border);
        }
        .input-row:last-child { border-bottom: none; }
        .input-row label { flex: 1; font-size: 16px; }
        .input-row input, .input-row select, .input-row textarea {
            background: none; border: none; color: var(--accent);
            text-align: right; font-size: 16px; outline: none; width: 60%;
        }
        textarea { text-align: left !important; width: 100% !important; height: 80px; padding-top: 8px; }

        /* Checkbox styling */
        .checkbox-row { justify-content: space-between; cursor: pointer; }
        .checkbox-row input { width: auto; }

        .hint { font-size: 12px; color: var(--text-gray); padding: 8px 16px; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="header-top">
            <img src="mti,.png" alt="MTI" class="logo">
            <div class="lang-selector">
                <div class="lang-glider"></div>
                <div class="lang-option active" id="btn-ru" onclick="toggleLang('ru')">RU</div>
                <div class="lang-option" id="btn-en" onclick="toggleLang('en')">EN</div>
            </div>
        </div>
        <div id="txt-tagline" style="color: var(--text-gray);">Next-Gen Business Engineering</div>
    </header>

    <div class="main-grid">
        <div class="card" onclick="openSetup('Beauty')">
            <div class="card-label">Beauty</div>
            <div class="card-sub" id="txt-beauty-sub">Запись, услуги и CRM</div>
        </div>
        <div class="card" onclick="openSetup('Crypto')">
            <div class="card-label">Crypto</div>
            <div class="card-sub" id="txt-crypto-sub">Подписки и CryptoBot</div>
        </div>
    </div>

    <div class="card" style="margin-bottom: 12px;" onclick="openSetup('AI')">
        <div class="card-label">AI & Custom</div>
        <div class="card-sub" id="txt-ai-sub">Индивидуальные решения под ключ</div>
    </div>

    <div class="section-title" id="txt-resources">Ресурсы</div>
    <div class="input-group">
        <a href="https://t.me/mti_news" class="input-row" style="text-decoration: none; color: inherit;">
            <label>MTI News</label><span style="color: var(--text-gray)">›</span>
        </a>
        <a href="https://t.me/mti_cases" class="input-row" style="text-decoration: none; color: inherit;">
            <label>Case Archive</label><span style="color: var(--text-gray)">›</span>
        </a>
    </div>
</div>

<!-- ЭКРАН НАСТРОЙКИ -->
<div id="setup-screen">
    <h1 id="setup-title" style="font-size: 32px; margin: 10px 0 20px;">Module</h1>

    <!-- БЛОК 1: ПОДКЛЮЧЕНИЕ -->
    <div class="section-title" id="txt-sec-auth">Подключение</div>
    <div class="input-group">
        <div class="input-row">
            <label>Bot Token</label>
            <input type="text" id="inp-token" placeholder="712345:AAH...">
        </div>
        <div class="input-row">
            <label id="txt-bot-name">Имя бота</label>
            <input type="text" id="inp-botname" placeholder="@my_bot">
        </div>
    </div>
    <div class="hint">Получите токен у @BotFather</div>

    <!-- БЛОК 2: ДИНАМИЧЕСКИЕ НАСТРОЙКИ (заполняются через JS) -->
    <div class="section-title" id="txt-sec-config">Конфигурация</div>
    <div class="input-group" id="dynamic-fields">
        <!-- Сюда JS добавит поля -->
    </div>

    <!-- БЛОК 3: ДИЗАЙН И БРЕНДИНГ -->
    <div class="section-title" id="txt-sec-design">Дизайн и Брендинг</div>
    <div class="input-group">
        <div class="input-row checkbox-row" onclick="toggleCheck('chk-avatar')">
            <label id="txt-design-ava">Аватарка и описание</label>
            <input type="checkbox" id="chk-avatar">
        </div>
        <div class="input-row checkbox-row" onclick="toggleCheck('chk-welcome')">
            <label id="txt-design-welcome">Приветственный баннер</label>
            <input type="checkbox" id="chk-welcome">
        </div>
        <div class="input-row checkbox-row" onclick="toggleCheck('chk-info')">
            <label id="txt-design-info">Инфографика услуг</label>
            <input type="checkbox" id="chk-info">
        </div>
    </div>
    <div class="hint" id="txt-design-hint">Мы подготовим профессиональный визуал для вашего бренда</div>

    <div style="height: 100px;"></div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let currentMod = '';

    const translations = {
        ru: {
            tagline: "Бизнес-инжиниринг нового поколения",
            beautySub: "Запись, услуги и CRM",
            cryptoSub: "Подписки и CryptoBot",
            aiSub: "Индивидуальные решения под ключ",
            resources: "Ресурсы",
            secAuth: "Подключение",
            secConfig: "Конфигурация",
            secDesign: "Дизайн и Брендинг",
            botName: "Имя бота",
            designAva: "Аватарка и описание",
            designWelcome: "Приветственный баннер",
            designInfo: "Инфографика услуг",
            designHint: "Мы подготовим профессиональный визуал для вашего бренда",
            btnSave: "Сохранить и запустить",
            placeholderServices: "Маникюр: 1500\nПедикюр: 2000",
            labelServices: "Список услуг",
            labelPrice: "Цена (USDT)",
            labelChannel: "ID Канала"
        },
        en: {
            tagline: "Next-Gen Business Engineering",
            beautySub: "Booking, Services & CRM",
            cryptoSub: "Subscriptions & CryptoBot",
            aiSub: "Custom Turnkey Solutions",
            resources: "Resources",
            secAuth: "Connection",
            secConfig: "Configuration",
            secDesign: "Design & Branding",
            botName: "Bot Username",
            designAva: "Avatar & Bio",
            designWelcome: "Welcome Banner",
            designInfo: "Service Infographics",
            designHint: "We will create professional visuals for your brand",
            btnSave: "Save & Launch",
            placeholderServices: "Manicure: 50\nPedicure: 70",
            labelServices: "Service List",
            labelPrice: "Price (USDT)",
            labelChannel: "Channel ID"
        }
    };

    function toggleLang(lang) {
        document.body.classList.toggle('lang-en', lang === 'en');
        document.getElementById('btn-ru').classList.toggle('active', lang === 'ru');
        document.getElementById('btn-en').classList.toggle('active', lang === 'en');
        updateTexts(lang);
        tg.HapticFeedback.selectionChanged();
    }

    function updateTexts(lang) {
        const t = translations[lang];
        document.getElementById('txt-tagline').innerText = t.tagline;
        document.getElementById('txt-beauty-sub').innerText = t.beautySub;
        document.getElementById('txt-crypto-sub').innerText = t.cryptoSub;
        document.getElementById('txt-ai-sub').innerText = t.aiSub;
        document.getElementById('txt-resources').innerText = t.resources;
        document.getElementById('txt-sec-auth').innerText = t.secAuth;
        document.getElementById('txt-sec-config').innerText = t.secConfig;
        document.getElementById('txt-sec-design').innerText = t.secDesign;
        document.getElementById('txt-bot-name').innerText = t.botName;
        document.getElementById('txt-design-ava').innerText = t.designAva;
        document.getElementById('txt-design-welcome').innerText = t.designWelcome;
        document.getElementById('txt-design-info').innerText = t.designInfo;
        document.getElementById('txt-design-hint').innerText = t.designHint;
        if(tg.MainButton.isVisible) tg.MainButton.setText(t.btnSave);
    }

    function openSetup(mod) {
        currentMod = mod;
        document.getElementById('setup-title').innerText = mod + ' Module';
        const fields = document.getElementById('dynamic-fields');
        fields.innerHTML = '';

        const lang = document.body.classList.contains('lang-en') ? 'en' : 'ru';
        const t = translations[lang];

        if (mod === 'Beauty') {
            fields.innerHTML = `
                <div class="input-row" style="flex-direction: column; align-items: flex-start;">
                    <label style="margin-bottom: 8px;">${t.labelServices}</label>
                    <textarea id="cfg-services" placeholder="${t.placeholderServices}"></textarea>
                </div>
                <div class="input-row">
                    <label>Рабочее время</label>
                    <input type="text" id="cfg-hours" placeholder="10:00 - 20:00">
                </div>
            `;
        } else if (mod === 'Crypto') {
            fields.innerHTML = `
                <div class="input-row">
                    <label>${t.labelPrice}</label>
                    <input type="number" id="cfg-price" placeholder="50">
                </div>
                <div class="input-row">
                    <label>${t.labelChannel}</label>
                    <input type="text" id="cfg-channel" placeholder="-100...">
                </div>
            `;
        } else {
            fields.innerHTML = `<div class="hint">Опишите вашу задачу в сообщении после сохранения, и мы свяжемся для разработки архитектуры.</div>`;
        }

        document.getElementById('setup-screen').classList.add('active');
        tg.MainButton.setText(t.btnSave);
        tg.MainButton.show();
        tg.BackButton.show();
        tg.HapticFeedback.impactOccurred('medium');
    }

    function toggleCheck(id) {
        const el = document.getElementById(id);
        el.checked = !el.checked;
        tg.HapticFeedback.selectionChanged();
    }

    tg.BackButton.onClick(() => {
        document.getElementById('setup-screen').classList.remove('active');
        tg.MainButton.hide();
        tg.BackButton.hide();
    });

    tg.MainButton.onClick(() => {
        const data = {
            module: currentMod,
            token: document.getElementById('inp-token').value,
            botName: document.getElementById('inp-botname').value,
            config: {},
            design: {
                avatar: document.getElementById('chk-avatar').checked,
                welcome: document.getElementById('chk-welcome').checked,
                infographics: document.getElementById('chk-info').checked
            }
        };

        if (currentMod === 'Beauty') {
            data.config.services = document.getElementById('cfg-services').value;
            data.config.hours = document.getElementById('cfg-hours').value;
        } else if (currentMod === 'Crypto') {
            data.config.price = document.getElementById('cfg-price').value;
            data.config.channelId = document.getElementById('cfg-channel').value;
        }

        if (!data.token) {
            tg.showAlert("Пожалуйста, введите Bot Token");
            return;
        }

        tg.HapticFeedback.notificationOccurred('success');
        tg.sendData(JSON.stringify(data));
    });

    // Инициализация
    updateTexts('ru');
</script>

</body>
</html>
