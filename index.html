<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MTI | Next-Gen</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #000000; --card: #1C1C1E; --accent: #007AFF; --text: #FFFFFF;
            --text-gray: #8E8E93; --border: rgba(255, 255, 255, 0.1);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, system-ui, sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 0; overflow: hidden; }
        .container { padding: calc(env(safe-area-inset-top) + 20px) 16px; max-width: 440px; margin: 0 auto; }
        
        /* Header & Lang */
        header { margin-bottom: 32px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        .logo { height: 38px; }
        .lang-selector { position: relative; background: rgba(255,255,255,0.1); border-radius: 10px; display: flex; width: 84px; height: 32px; padding: 2px; }
        .lang-option { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; color: var(--text-gray); z-index: 2; cursor: pointer; }
        .lang-option.active { color: #fff; }
        .lang-glider { position: absolute; top: 2px; left: 2px; width: 40px; height: 28px; background: rgba(255,255,255,0.2); border-radius: 8px; transition: 0.3s; }
        body.lang-en .lang-glider { transform: translateX(40px); }

        /* Grid */
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
        .tall-card { background: var(--card); border-radius: 28px; height: 240px; padding: 24px; display: flex; flex-direction: column; justify-content: space-between; border: 0.5px solid var(--border); position: relative; overflow: hidden; }
        .symbol { position: absolute; top: -10px; right: -20px; width: 150px; opacity: 0.1; transform: rotate(15deg); }
        .card-label { font-size: 22px; font-weight: 700; }
        .card-sub { font-size: 13px; color: var(--text-gray); }

        .wide-card { background: var(--card); border-radius: 24px; padding: 20px; border: 0.5px solid var(--border); display: flex; align-items: center; margin-bottom: 20px; }
        .ai-indicator { width: 40px; height: 40px; border-radius: 50%; background: conic-gradient(#007AFF, #AF52DE, #007AFF); filter: blur(8px); opacity: 0.6; position: absolute; }

        /* Payment UI */
        #payment-screen { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: none; flex-direction: column; padding-top: 40px; }
        #payment-screen.active { display: flex; }
        .price-big { font-size: 56px; font-weight: 800; text-align: center; margin: 40px 0; }
        .ios-group { background: var(--card); border-radius: 12px; margin: 0 16px; overflow: hidden; }
        .ios-item { padding: 16px; display: flex; align-items: center; border-bottom: 0.5px solid var(--border); }
        .ios-label { flex: 1; font-size: 17px; }
        select { background: none; border: none; color: var(--accent); font-size: 17px; outline: none; }
    </style>
</head>
<body>

<div class="container" id="main-menu">
    <header>
        <div class="header-top">
            <img src="mti,.png" alt="MTI" class="logo">
            <div class="lang-selector" onclick="toggleLang()">
                <div class="lang-glider"></div>
                <div class="lang-option active" id="btn-ru">RU</div>
                <div class="lang-option" id="btn-en">EN</div>
            </div>
        </div>
        <p id="txt-tagline">Next-Gen Business Engineering</p>
    </header>

    <div class="main-grid">
        <div class="tall-card" onclick="sendToBot('setup_beauty')">
            <div class="symbol">⭐</div>
            <div>
                <div class="card-label">Beauty</div>
                <div class="card-sub" id="txt-beauty-sub">Service ecosystem</div>
            </div>
        </div>
        <div class="tall-card" onclick="sendToBot('setup_crypto')">
            <div class="symbol">₿</div>
            <div>
                <div class="card-label">Crypto</div>
                <div class="card-sub" id="txt-crypto-sub">Web3 node infra</div>
            </div>
        </div>
    </div>

    <div class="wide-card" onclick="sendToBot('setup_ai')">
        <div style="position:relative; width:40px; height:40px; margin-right:15px;">
            <div class="ai-indicator"></div>
        </div>
        <div>
            <div class="card-label" style="font-size:18px">AI & Custom</div>
            <div class="card-sub">Individual architecture</div>
        </div>
    </div>
</div>

<!-- Экран оплаты -->
<div id="payment-screen">
    <div style="text-align:center; color:var(--text-gray)" id="txt-pay-for">Оплата подписки</div>
    <div class="price-big" id="pay-amount">49.00$</div>
    
    <div class="ios-group">
        <div class="ios-item">
            <span class="ios-label">Метод оплаты</span>
            <select id="pay-method">
                <option value="cryptobot">CryptoBot</option>
                <option value="stars">Telegram Stars</option>
                <option value="card">Банковская карта</option>
            </select>
        </div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let currentLang = 'ru';

    // 1. Отправка команды боту для начала настройки
    function sendToBot(command) {
        tg.HapticFeedback.impactOccurred('medium');
        tg.sendData(command); // Бот получит это сообщение
        tg.close();
    }

    // 2. Проверка: не открыли ли нас для оплаты?
    // Ссылка будет вида: t.me/bot/app?startapp=pay_49_beauty
    const startParam = tg.initDataUnsafe.start_param;
    if (startParam && startParam.startsWith('pay')) {
        const [_, amount, module] = startParam.split('_');
        showPayment(amount, module);
    }

    function showPayment(amount, module) {
        document.getElementById('main-menu').style.display = 'none';
        const screen = document.getElementById('payment-screen');
        screen.classList.add('active');
        document.getElementById('pay-amount').innerText = amount + '$';
        document.getElementById('txt-pay-for').innerText = "Модуль: " + module.toUpperCase();

        tg.MainButton.setText("ОПЛАТИТЬ");
        tg.MainButton.show();
    }

    tg.MainButton.onClick(() => {
        const method = document.getElementById('pay-method').value;
        tg.sendData("pay_confirm_" + method);
        tg.HapticFeedback.notificationOccurred('success');
    });

    function toggleLang() {
        currentLang = currentLang === 'ru' ? 'en' : 'ru';
        document.body.classList.toggle('lang-en');
        tg.HapticFeedback.selectionChanged();
    }
</script>
</body>
</html>
