<style>
    /* –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø SETUP */
    :root {
        --bg: #000000;
        --card: #1C1C1E;
        --secondary-card: #2C2C2E;
        --accent: #007AFF;
        --text: #FFFFFF;
        --text-gray: #8E8E93;
        --border: rgba(255, 255, 255, 0.1);
        --glass: rgba(255, 255, 255, 0.05);
        --ios-blue: #007AFF;
    }

    #setup {
        position: fixed;
        inset: 0;
        background: var(--bg);
        z-index: 1000;
        padding-top: calc(env(safe-area-inset-top) + 10px);
        transform: translateY(100%);
        transition: transform 0.5s cubic-bezier(0.15, 0.4, 0.05, 1);
        display: flex;
        flex-direction: column;
    }

    #setup.active { transform: translateY(0); }

    .setup-header {
        padding: 0 20px;
        margin-bottom: 20px;
    }

    /* iOS Style Progress Bar */
    .progress-steps {
        display: flex;
        gap: 4px;
        margin-bottom: 24px;
    }
    .dot {
        height: 3px;
        flex: 1;
        background: #3A3A3C;
        border-radius: 2px;
        transition: background 0.4s ease;
    }
    .dot.active { background: var(--text-gray); }
    .dot.completed { background: var(--ios-blue); }

    .step-title {
        font-size: 32px;
        font-weight: 700;
        letter-spacing: -1px;
        margin-bottom: 8px;
        color: #fff;
    }

    .step-desc {
        font-size: 16px;
        color: var(--text-gray);
        line-height: 1.4;
        margin-bottom: 10px;
    }

    /* iOS Inset Grouped List Style */
    .ios-group {
        background: var(--card);
        border-radius: 12px;
        margin: 0 16px 24px;
        overflow: hidden;
    }

    .ios-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        min-height: 48px;
        position: relative;
    }

    .ios-item:not(:last-child)::after {
        content: '';
        position: absolute;
        bottom: 0;
        right: 0;
        left: 56px;
        height: 0.5px;
        background: var(--border);
    }

    .ios-icon {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        font-size: 16px;
    }

    .ios-content {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .ios-label {
        font-size: 13px;
        color: var(--text-gray);
        margin-bottom: 2px;
    }

    .ios-input {
        background: none;
        border: none;
        color: #fff;
        font-size: 17px;
        padding: 0;
        width: 100%;
        outline: none;
    }

    .ios-input::placeholder { color: #48484A; }

    /* AI Magic Textarea */
    .ai-textarea-container {
        position: relative;
        background: var(--card);
        border-radius: 14px;
        padding: 16px;
        margin: 0 16px;
        border: 1px solid transparent;
        transition: border-color 0.3s ease;
    }

    .ai-textarea-container:focus-within {
        border-color: rgba(0, 122, 255, 0.4);
    }

    .ai-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: linear-gradient(135deg, rgba(0, 122, 255, 0.15), rgba(175, 82, 222, 0.15));
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        color: #AF52DE;
        margin-bottom: 12px;
    }

    .ai-hint {
        font-size: 13px;
        color: var(--text-gray);
        margin-top: 12px;
        line-height: 1.4;
    }

    textarea.ios-input {
        height: 140px;
        line-height: 1.5;
        resize: none;
    }

    select.ios-input {
        appearance: none;
        background: url("data:image/svg+xml,%3Csvg width='10' height='16' viewBox='0 0 10 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3 Jacques%3Cpath d='M2 4L6 8L2 12' stroke='%2348484A' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E") no-repeat right center;
    }

    /* –ü–ª–∞–≤–Ω–æ—Å—Ç—å —Å–ª–∞–π–¥–µ—Ä–∞ */
    .steps-slider {
        display: flex;
        flex: 1;
        transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    }
</style>

<!-- –û–ë–ù–û–í–õ–ï–ù–ù–´–ô HTML –ú–û–î–ê–õ–ö–ò -->
<div id="setup">
    <div class="setup-header">
        <div class="progress-steps" id="progress-dots"></div>
        <div class="step-title" id="step-title">–ù–∞–∑–≤–∞–Ω–∏–µ</div>
        <div class="step-desc" id="step-desc">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞</div>
    </div>

    <div class="steps-slider" id="steps-slider">
        <!-- –®–∞–≥ 1: –û–±—â–µ–µ -->
        <div class="step-page">
            <div class="ios-group">
                <div class="ios-item">
                    <div class="ios-icon" style="background: #5856D6;">üè¢</div>
                    <div class="ios-content">
                        <span class="ios-label" id="txt-form-name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</span>
                        <input type="text" id="p-name" class="ios-input" placeholder="–ù–∞–ø—Ä: MTI Beauty">
                    </div>
                </div>
                <div class="ios-item">
                    <div class="ios-icon" style="background: #007AFF;">üîó</div>
                    <div class="ios-content">
                        <span class="ios-label" id="txt-form-link">–ö–æ–Ω—Ç–∞–∫—Ç (TG)</span>
                        <input type="text" id="p-link" class="ios-input" placeholder="@username">
                    </div>
                </div>
            </div>
        </div>

        <!-- –®–∞–≥ 2: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π (Beauty –∏–ª–∏ Crypto) -->
        <div class="step-page" id="context-step-1"></div>

        <!-- –®–∞–≥ 3: –ü—Ä–∞–π—Å (Beauty) -->
        <div class="step-page" id="context-step-2"></div>

        <!-- –®–∞–≥ 4: –û–ø–ª–∞—Ç–∞ -->
        <div class="step-page" id="final-step">
            <div class="ios-group">
                <div class="ios-item">
                    <div class="ios-icon" style="background: #34C759;">üí≥</div>
                    <div class="ios-content">
                        <span class="ios-label" id="txt-form-method">–ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã</span>
                        <select id="p-method" class="ios-input">
                            <option value="cryptobot">CryptoBot (USDT, TON)</option>
                            <option value="yookassa">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞ (RU)</option>
                        </select>
                    </div>
                </div>
            </div>
            <p style="padding: 0 20px; font-size: 13px; color: #48484A; text-align: center;" id="txt-hint-pay">
                –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–µ—Ä–µ–∑ —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–ª—é–∑
            </p>
        </div>
    </div>
</div>

<script>
    // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò –ö–û–ù–¢–ï–ù–¢–ê –®–ê–ì–û–í
    function setupStepContent() {
        const step2 = document.getElementById('context-step-1');
        const step3 = document.getElementById('context-step-2');
        const isRu = currentLang === 'ru';
        
        if (activeModule === 'Beauty') {
            step2.innerHTML = `
                <div class="ios-group">
                    <div class="ios-item">
                        <div class="ios-icon" style="background: #FF9500;">üìç</div>
                        <div class="ios-content">
                            <span class="ios-label">${isRu ? '–ê–¥—Ä–µ—Å' : 'Address'}</span>
                            <input type="text" id="p-addr" class="ios-input" placeholder="${isRu ? '–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞...' : 'Street, City...'}">
                        </div>
                    </div>
                    <div class="ios-item">
                        <div class="ios-icon" style="background: #FF3B30;">üïí</div>
                        <div class="ios-content">
                            <span class="ios-label">${isRu ? '–ì—Ä–∞—Ñ–∏–∫' : 'Working Hours'}</span>
                            <input type="text" id="p-hours" class="ios-input" placeholder="09:00 - 21:00">
                        </div>
                    </div>
                </div>`;
            
            step3.innerHTML = `
                <div class="ai-textarea-container">
                    <div class="ai-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"/></svg>
                        AI ENGINE READY
                    </div>
                    <textarea id="p-price" class="ios-input" placeholder="${isRu ? '–°—Ç—Ä–∏–∂–∫–∞ ‚Äî 1500\n–ú–∞–Ω–∏–∫—é—Ä: 2000—Ä...' : 'Haircut - 50\nNails - 40...'}"></textarea>
                    <div class="ai-hint">
                        ${isRu ? '‚ú® <b>–ü–∏—à–∏—Ç–µ –≤ –ª—é–±–æ–º —Ñ–æ—Ä–º–∞—Ç–µ</b> ‚Äî –Ω–∞—à –ò–ò —Å–∞–º —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —É—Å–ª—É–≥–∏ –∏ —Ü–µ–Ω—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç –∏—Ö –∏ –¥–æ–±–∞–≤–∏—Ç –≤ –±–∞–∑—É.' : '‚ú® <b>Write in any format</b> ‚Äî our AI will automatically recognize services and prices to structure your database.'}
                    </div>
                </div>`;
        } else if (activeModule === 'Crypto') {
            step2.innerHTML = `
                <div class="ios-group">
                    <div class="ios-item">
                        <div class="ios-icon" style="background: #5856D6;">üîë</div>
                        <div class="ios-content">
                            <span class="ios-label">CryptoBot API Token</span>
                            <input type="text" id="p-api" class="ios-input" placeholder="123456:AAH...">
                        </div>
                    </div>
                </div>
                <p style="padding: 0 20px; font-size: 13px; color: #8E8E93;">
                    ${isRu ? '–¢–æ–∫–µ–Ω –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≤—ã–ø–ª–∞—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.' : 'Token is required for automated payouts and transaction verification.'}
                </p>`;
            step3.innerHTML = '';
        }
    }

    // –î–æ–±–∞–≤—å –≤ updateStepUI –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–æ—á–µ–∫ (completed)
    function updateStepUI() {
        const slider = document.getElementById('steps-slider');
        slider.style.transform = `translateX(-${currentStep * 100}%)`;
        
        const dots = document.querySelectorAll('.dot');
        dots.forEach((d, i) => {
            d.classList.toggle('active', i === currentStep);
            d.classList.toggle('completed', i < currentStep);
        });

        const title = document.getElementById('step-title');
        const desc = document.getElementById('step-desc');
        const isRu = (currentLang === 'ru');

        // –õ–æ–≥–∏–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        if (currentStep === 0) {
            title.innerText = isRu ? "–û—Å–Ω–æ–≤—ã" : "Basics";
            desc.innerText = isRu ? "–ù–∞—Å—Ç—Ä–æ–∏–º –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é" : "Let's set up basic info";
        } else if (currentStep === totalSteps - 1) {
            title.innerText = isRu ? "–û–ø–ª–∞—Ç–∞" : "Billing";
            desc.innerText = isRu ? "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω" : "Choose your plan";
            tg.MainButton.text = isRu ? "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" : "Confirm";
        } else {
            if (activeModule === 'Beauty') {
                if (currentStep === 1) {
                    title.innerText = isRu ? "–õ–æ–∫–∞—Ü–∏—è" : "Location";
                    desc.innerText = isRu ? "–ì–¥–µ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å?" : "Where is your salon?";
                } else {
                    title.innerText = isRu ? "–£—Å–ª—É–≥–∏" : "Services";
                    desc.innerText = isRu ? "–í–∞—à –ø—Ä–∞–π—Å-–ª–∏—Å—Ç" : "Your price list";
                }
            } else {
                title.innerText = isRu ? "–ö–æ—à–µ–ª–µ–∫" : "Wallet";
                desc.innerText = isRu ? "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π" : "Payment setup";
            }
            tg.MainButton.text = isRu ? "–î–∞–ª–µ–µ" : "Next";
        }
    }
</script>
